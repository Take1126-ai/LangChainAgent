# LangChain CLI Agent

## 概要

本プロジェクトは、LangChainフレームワークを活用した対話型AI CLIツールです。ユーザーからの自然言語による指示を理解し、適切なツール（インターネット検索、フォルダ・ファイル操作、コマンド実行など）を呼び出してタスクを実行します。実行結果は検証エージェントによってチェックされ、最終的な応答はユーザーに自然言語でフィードバックされます。問題が発生した場合は、自律的に解決策を検討し、必要に応じてユーザーに対応の実行許諾を得ます。

## 機能

### メインAIエージェント
`LangGraph` を用いたステートマシンベースのエージェントが、複雑な思考プロセス、ツール呼び出し、検証エージェントとの連携を柔軟に制御します。会話履歴は `src/config.py` の `MEMORY_TURNS` で設定されたターン数に制限されます（`0` の場合は上限なし）。

### 検証エージェント (Hallucination Countermeasure)
メインAIエージェントの最終応答、使用したツールの結果、およびユーザーの元の要求を照合し、ハルシネーションや不適切な出力がないかをチェックします。検証の最大試行回数は `src/config.py` の `MAX_VERIFICATION_ATTEMPTS` で設定可能です。

### ツール
以下のツールが利用可能です。
- **インターネット検索ツール**: インターネットから情報を検索します。
- **ファイル・ディレクトリ操作ツール**: ファイルやディレクトリの作成、読み書き、削除、移動、内容検索などを行います。
- **コマンド実行ツール**: シェルコマンドを実行します。危険なコマンド実行前にはユーザーの確認を求めます。

## インストール

`uv` を使用して依存関係をインストールします。

```bash
uv sync
```

## 使用方法

`main.py` を実行してCLI AIアシスタントと会話を開始します。

```bash
uv run main.py
```

会話を終了するには `exit` と入力してください。

### 使用例

#### 1. 簡単な会話

```
$ uv run main.py
CLI AIアシスタントと会話を開始します。終了するには 'exit' と入力してください。
あなた: こんにちは
AI: こんにちは！何かお手伝いできることはありますか？
```

#### 2. インターネット検索ツールの使用

```
あなた: LangChainについてインターネットで調べてください
AI: LangChainは、大規模言語モデル（LLM）を活用したアプリケーション開発を支援するPythonライブラリおよびフレームワークです。...
```

#### 3. ファイル操作ツールの使用

```
あなた: カレントディレクトリの内容を教えてください
AI: 現在のディレクトリには以下のファイルとディレクトリがあります:
- main.py
- src/
- docs/
- ...
```

#### 4. コマンド実行ツールの使用

```
あなた: ls -l コマンドを実行して、現在のディレクトリの内容を詳細に表示してください。
AIは 'run_shell_command' を実行しようとしています。引数: {'command': 'ls -l'}
選択肢:
  1. 一度だけ実行許可
  2. 今後も実行許可 (この種類のツールは次回から確認しません)
  3. 実行を許可せず、新しい指示を入力する
選択肢 (1/2/3): 1
AI: total 40
-rw-r--r-- 1 user user 1234 Jan  1 00:00 main.py
...
```

## 設定

`src/config.py` ファイルで以下の設定を変更できます。

- `MODEL_NAME`: 使用するGeminiモデルの名前。
- `API_KEY`: Google Gemini APIのキー。
- `MEMORY_TURNS`: 会話履歴に保持するターン数。`0` の場合は上限なし。
- `MAX_VERIFICATION_ATTEMPTS`: 検証エージェントが問題を解決しようとする最大試行回数。

### .envファイルの設定例

プロジェクトルートに `.env` ファイルを作成し、以下の内容を記述してください。

```dotenv
GEMINI_MODEL_NAME=models/gemini-2.0-flash
GOOGLE_API_KEY=YOUR_API_KEY
TAVILY_API_KEY=YOUR_TAVILY_API_KEY
```
